-----

# 🏎️ ①AutoRacer Course Maker

自動運転ミニカーバトル用のカスタムコース図を作成するためのWebアプリケーションです。

本ツールはDockerコンテナ上で動作するため、チームメンバー全員が同じ環境（Node.js, ライブラリバージョン）で作業できます。

## ⚙️ 基本情報

| 項目 | 詳細 | 備考 |
| :--- | :--- | :--- |
| **コース寸法 (W x H)** | 1000cm × 546cm | 横長固定 |
| **レーン幅** | 1.5cm (初期値は操作性の問題から15cmとしている。) | |
| **実行環境** | Docker Compose | Windows, Mac, Linuxで共通 |
| **アクセスURL** | `http://localhost:5173` | |

-----

## 🚀 環境構築と起動手順

### 1\. 事前準備

PCに **Git** および **Docker Desktop** がインストールされ、起動していることを確認してください。

### 2\. リポジトリのクローン

以下のコマンドでプロジェクトをダウンロードします。

```bash
git clone https://github.com/samatsum/CourceMaker.git
cd CourceMaker
```

### 3\. 環境の構築と起動

`docker-compose.yml` に基づき、Webアプリ環境が自動で構築・起動します。

```bash
docker compose up -d
```

> **💡 [補足]** 初回起動時は、`package-lock.json` に基づいて必要なライブラリが自動でインストールされるため、時間がかかります。

### 4\. アプリケーションへのアクセス

ブラウザを開き、以下のURLにアクセスしてください。

```
http://localhost:5173
```

-----

## 🕹️ 主な機能と使い方

コース図作成ソフトは、コース図エリアの\*\*左側にある「パーツ置き場」\*\*からパーツをドラッグ＆ドロップして使用します。

### 1\. パーツ追加と管理

| ボタン | 長さ | カウンター | 出現場所 |
| :--- | :--- | :--- | :--- |
| **＋黄 (N)** | 120cm | 現在の黄色パーツ数を2桁表示 | パレット上段 |
| **＋青 (N)** | 60cm | 現在の青色パーツ数を2桁表示 | パレット中段 |
| **＋緑 (N)** | 42cm | 現在の緑色パーツ数を2桁表示 | パレット下段 |

### 2\. 編集操作

| 機能 | 使い方 | 備考 |
| :--- | :--- | :--- |
| **ドラッグ** | パーツの中心（黒丸）を掴んで移動させます。 | **ドラッグ中のパーツは常に最前面に表示されます。** |
| **コピペ** | 選択中のパーツを20cmずらした位置に複製します。 | |
| **↻ 1°, 10°, 45°, 90°** | 選択中のパーツを、中心を基準に回転させます。 | |
| **🔒 固定 〇/×** | 選択中のパーツの移動・回転・削除をロックします。 | **固定されたパーツとのみ衝突チェックが有効**になります。 |
| **削除モード: 〇/×** | **〇**にすると、クリックするだけで固定されていないパーツを即座に削除できます。 | |

### 3\. 衝突判定の仕様

  * **衝突判定の対象:** ドラッグ中のパーツと、**固定されているパーツ**のみ。
  * **非固定パーツ同士:** 自由に重ねて配置可能です。
  * **判定方法:** レーンが回転していても正確に判定できる \*\*SAT（分離軸判定法）\*\*を採用しています。

### 4\. コース図の出力（画像保存）

  * **ボタン:** `📷 コース図保存 (.jpg)` (赤色ボタン)
  * **機能:** 左側の「パーツ置き場」を除外した、\*\*コース図エリア（1000cm x 546cm）\*\*のみをJPEG画像として保存します。
  * **ファイル名:** `CourceImage_YYYYMMDD_HHMMSS.jpg` の形式で日時が自動付与されます。

-----

# 🐾 ②FootPrintOnCource
マウスセンサーを利用したオドメトリ（移動量）計測・解析・軌跡プロットツールです。
高ポーリングレート（1000Hz）でマウスの移動量（ミッキー）を取得し、CSVログへの保存とコース画像上への軌跡描画を自動で行います。

## 動作環境

- **Python 3.12** 以上
- **OS:** Windows / macOS / Linux
- **推奨マウス:** 高DPI・高ポーリングレート対応のゲーミングマウス (例: Logicool G304)

## セットアップ手順 (Installation)

このリポジトリをクローンまたはダウンロードした後、以下の手順で環境を構築してください。

### 1. 依存ライブラリのインストール

ターミナル（またはコマンドプロンプト/PowerShell）を開き、プロジェクトのディレクトリで以下のコマンドを実行します。

#### 🪟 Windows の場合
```powershell
py -3.12 -m pip install -r requirements.txt
````

*(※ Pythonランチャーを使用していない場合は `pip install -r requirements.txt` )*

#### 🍎 macOS / 🐧 Linux の場合

```bash
pip3 install -r requirements.txt
```

### 2\. コース画像の配置

計測したいコースの画像ファイルを、スクリプトと同じディレクトリに配置してください。
ファイル名は `CourceImage` で始まり、拡張子が `.jpg` または `.jpeg` である必要があります。

  * 例: `CourceImage.jpg`, `CourceImage_20251207_1432.jpeg`
  * **注意:** 画像がない場合、プロットは白背景に行われます。

-----

## 使い方 (Usage)

以下のコマンドでツールを起動します。引数として「マウスの名前（または実験名）」を指定してください。

#### 🪟 Windows の場合

```powershell
py -3.12 mickey_logger_auto_image.py <マウス名>
```

*例:* `py -3.12 FootPrint.py G304_Test01`

#### 🍎 macOS / 🐧 Linux の場合

```bash
python3 FootPrint.py <マウス名>
```

### 操作方法

1.  コマンドを実行すると、黒いウィンドウが立ち上がり計測が開始されます。
2.  マウスを動かすと、リアルタイムでデータが取得されます。
3.  **[ESC] キー** を押すと計測を終了します。
4.  終了後、自動的に解析が行われ、軌跡画像が保存されます。

-----

## 出力ファイル (Output)

実行後、`Log/<マウス名>/<マウス名>_<日時>/` ディレクトリが自動生成され、以下のファイルが保存されます。

  * `raw_data.log`: 取得した生のミッキーデータ (CSV)
  * `analyze.log`: 計算済みの距離・角度データ (CSV)
  * `trajectory_plot.png`: コース画像上に軌跡を重ねたプロット画像

## 設定の変更 (Configuration)

`mickey_logger_auto_image.py` 内の `CourseConstants` クラスを編集することで、以下の設定を変更できます。

  * **DPI\_SETTING:** マウスのDPI設定 (デフォルト: 800)
  * **REAL\_W\_CM / REAL\_H\_CM:** コースの実寸サイズ (cm)
  * **IMG\_W\_PX / IMG\_H\_PX:** 背景画像のピクセルサイズ
  * **START\_PX\_X / START\_PX\_Y:** スタート地点のピクセル座標

## ライセンス

This project is open source.

```
```
